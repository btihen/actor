#!/usr/bin/env bash

source /usr/local/share/chruby/chruby.sh

STRESS_TEST=$1

set -eu

export STRESS_TEST=${STRESS_TEST:=low}

VERBOSE=${VERBOSE:=off}

function testRubyVersion() {
  ruby=$1

  chruby $ruby

  echo
  echo "Testing $ruby $(ruby -e 'puts RUBY_DESCRIPTION')"
  echo "= = ="
  echo

  if [ $VERBOSE = 'on' ]; then
    bin/bench
  else
    bin/bench -q
  fi
}

testRubyVersion ruby
testRubyVersion jruby
#testRubyVersion rbx
